<hi:common_header runat="server" />
<meta name="format-detection" content="telephone=no" />
<style>
    body {
        /*overflow-x:hidden;*/
    }
    #le-video {
        width:100% !important;
    }
    #le-video *{
        width:100% !important;
    }
    .tab-content *{
        max-width:100%;
    }
    .zixun-fixed {
        position:fixed;
        right:0;
        bottom:50px;
    }
    .zixun-fixed .link-zixun {
        display:block;
        background:rgba(255,255,255,0.8);
        width:60px;
        height:60px;
        text-align:center;
    }
     .zixun-fixed .link-zixun i {
        
        display: block;
        clear: both;
        width: 100%;
        height: 40px;
        margin-top: 6px;
        background: url("../images/icon-zixun.png") no-repeat;
        background-size: 30px !important;
        background-position: center center;
        margin: 6px 0 3px 0;    
    }
     .mask{
        display:none;
        position:fixed;
        top:0;
        left:0;
        right:0;
        bottom:0;
        background:#000;
        opacity:0.5;
        filter:alpha(opacity=50);
        z-index:11;
    }
    .imgGroupBox{
        display:none;
        position:fixed;
        left:0;
        right:0;
        top:50%;
        transform:translateY(-50%);
        -webkit-transform:translateY(-50%);
        z-index:12;
    }
    .swiper-wrapper img{
        width:100%;
    }
</style>
<div class="slides-collect-btn"  >
    <a id="addF" href="javascript:AddFavorite();" class="">
        <!-- <span class="glyphicon glyphicon-star-empty"></span> -->
        <span class="star-null"></span>
    </a>
    <a id="addedF" href="javascript:;" class="hide">
        <!-- <span class="glyphicon glyphicon-star"></span> -->
        <span class="star-full"></span>
    </a>
</div>
<div class="swiper-container" id="banner" onclick="showImgGroupBox()">
    <div class="swiper-wrapper">
        <hi:vshoptemplatedrepeater id="rptProductImages" templatefile="/Tags/skin-Common_Slide.ascx" runat="server" />
    </div>
    <!-- Add Pagination -->
    <div class="swiper-pagination"></div>
</div>
<div class="pbox bgColor-white goods-info">
        <div class="name font-lg">
            <asp:literal runat="server" id="litProdcutName" />
        </div>
        <div class="price clearfix">
            <asp:literal runat="server" id="litMemberGradeInfo" />
            <span class="spSalaPrice"><asp:literal runat="server" id="litSalePrice" /></span>
            <del class="text-muted font-s">¥<asp:literal runat="server" id="litMarketPrice" /></del>
            <span class="selled">已售：<b><asp:Literal ID="litSoldCount" runat="server" /></b>套</span>
        </div>
        <div><asp:Literal ID="litActivities" runat="server" /></div>
    </div>
<div class="white-bgbox">
    <h5>商品描述</h5>
    <asp:literal runat="server" id="litShortDescription" />
</div>
<div class="well" id="skuArea">
    <hi:common_skuselector id="skuSelector" runat="server" />
    <div class="buy-num">
        <div class="text-muted">
            购买数量</div>
        <div class="list clearfix">
            <div class="goods-num clearfix">
                <div id="spSub" class="shopcart-minus">-</div>
                <input type="tel" id="buyNum" class="form-control" value="1" />
                <div id="spAdd" class="shopcart-add">+</div>
                <div class="info font-s text-muted" style="display:none">库存：<span id="spStock"><asp:literal runat="server" id="litStock" /></span>件</div>
            </div>
        </div>
    </div>
</div>
<ul class="nav nav-tabs product_detail font-m" role="tablist">
  <li role="presentation" class="active"><a href="#product-detail" data-toggle="tab">商品详情</a></li>
  <li role="presentation"><a  href="#product-Guige" data-toggle="tab">商品规格</a></li>
  <li role="presentation"><a href="#product-eva" data-toggle="tab" onclick="gotoProductReview();">商品评价 (<asp:literal runat="server" id="litReviewsCount" />)</a></li>
</ul>
<div class="tab-content">
    <div role="tabpanel" class="tab-pane fade in active" id="product-detail">
        <div class="goods-detail bgColor-white btns-fixed-padding">
            <div class="panel panel-default">
                <div class="panel-heading">
                    属性
                </div>
                <table class="table" id="attrtable">
                    <tbody>
                        <hi:common_expandattributes id="ExpandAttributes" runat="server" />
                    </tbody>
                </table>
            </div>
            <asp:literal runat="server" id="litDescription" />
           
        </div>
    </div>
      <div role="tabpanel" class="tab-pane fade in active" id="product-Guige">
        <div class="goods-detail bgColor-white btns-fixed-padding">
            <asp:literal runat="server" id="litSpecification" />
        </div>
    </div>
</div>
<div class="btns-fixed">
    <a class="link link-shop" href="Default.aspx"><i></i><span>店铺</span></a>
    <!--<a class="link link-zixun" href="javascript:gotozixun()"><i></i><span>咨询</span></a>-->
    <a class="link link-like" href="javascript:AddFavorite();"><i></i><span>收藏</span></a>
   <!-- <a class="link link-like" href="#product-ask" data-toggle="tab" onclick="javascript:location.href='ProductConsultations.aspx'+location.search;">商品咨询 (<asp:literal runat="server" id="litConsultationsCount" />)</a>-->
    <!--<button id="addcartButton" type="shoppingBtn" onclick="AddProductToCart()" class="btn-car">加入购物车</button>-->
    <button id="buyButton" type="shoppingBtn" class="btn-buy">立即购买</button>
</div>
<div class="zixun-fixed"><a class="link link-zixun" href="javascript:gotozixun()"><i></i><span>咨询</span></a></div>
<div class="mask" onclick="hideImgGroupBox()"></div>
<div class="imgGroupBox">
    <div class="swiper-container" id="imgGroupBox">
        <div class="swiper-wrapper">
            <hi:vshoptemplatedrepeater id="rptProductImages1" templatefile="/Tags/skin-Common_Slide.ascx" runat="server" />
        </div>
        <!-- Add Pagination -->
        <div class="swiper-pagination"></div>
    </div>
</div>
<input type="hidden" runat="server" clientidmode="Static" id="litHasCollected" />
<input type="hidden" runat="server"   id="litCategoryId" />
<input type="hidden" runat="server"   id="litproductid" />
<input type="hidden" runat="server"   id="litproductcode" />
 <%<hi:weixinset id="weixin" runat="server"></hi:weixinset>%>
<span id="ItemParams" style="display:none">
    <asp:literal id="litItemParams"  runat="server"></asp:literal>
</span>

<script type="text/javascript">
    var swiper = new Swiper('#banner', {
        pagination: '.swiper-pagination',
        nextButton: '.swiper-button-next',
        prevButton: '.swiper-button-prev',
        paginationClickable: true,
        spaceBetween: 30,
        centeredSlides: true,
        loop: false,
        autoplay: 0,
        autoplayDisableOnInteraction: false
    });

    function showImgGroupBox() {
        $(".mask,.imgGroupBox").show();
        var swiper = new Swiper('#imgGroupBox', {
            pagination: '.swiper-pagination',
            nextButton: '.swiper-button-next',
            prevButton: '.swiper-button-prev',
            paginationClickable: true,
            spaceBetween: 30,
            centeredSlides: true,
            loop: false,
            autoplay: 0,
            autoplayDisableOnInteraction: false
        });
    }
    function hideImgGroupBox() {
        $(".mask,.imgGroupBox").hide();
    }

    function gotozixun() {
        location.href = 'ProductConsultations.aspx' + location.search;
    }

    function gotoProductReview() {
        window.location.href = 'ProductReview.aspx?ProductId=' + getParam('ProductId');
    }
    
    $(function () {
        $('.price em').click(function () {
            $('.price .actionnone').css('display', 'block');
            $(this).css("display", "none");
        })



        //var slidesImg = $('#slides img');
        //var width = 650, height = 650;
        //if (slidesImg.length > 1) {
        //    $('#slides').slidesjs({
        //        width: width,
        //        height: height,
        //        play: {
        //            active: true,
        //            auto: true,
        //            interval: 4000,
        //            swap: true
        //        }
        //    });
        //    $(".slidesjs-play, .slidesjs-stop, .slidesjs-previous, .slidesjs-next").remove();
        //    $(".slidesjs-pagination li").css("width", function(){return 100/slidesImg.length+"%"});
        //}
        //else {

        //    $('#slides').css('display','block').html('<div style="width:100%;"><a href="javascript:;"></a></div>');
        //    $('#slides div a').append(slidesImg);
        //}
    });


    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]); return null;
    }

    function AddFavorite() {
        var data = {};
        data.ProductId = getQueryString("productId");

        $.post("/api/VshopProcess.ashx?action=AddFavorite", data, function (json) {
            if (json.success === true) {
                $("#imgFavorite").hide().css('display', 'block').addClass('select');
                $('#addF').addClass('hide');
                $('#addedF').removeClass('hide');
                alert_h('收藏成功！');

            }
            else {
                alert_h('您当前还没有登录！', function () {
                    location.replace('/vshop/MyFavorites.aspx?returnUrl=/vshop/ProductDetails.aspx?productId=' + getParam('productId'));
                });
            }
        });
    }

    $(function () {
        var data = {};
        data.ProductId = getQueryString("productId");

        //根据是否收藏设置不同样式
        $.post("/api/VshopProcess.ashx?action=CheckFavorite", data, function (json) {
            if (json.success === true) {
                $("#imgFavorite").hide().css('display', 'block').addClass('select');

            }
        });

        if ($('#litHasCollected').val() == "1") {
            $('#addF').addClass('hide');
            $('#addedF').removeClass('hide');
        }

        //包含多个规格时，首先禁用购买和加入购物车按钮
        if ($(".SKUValueClass").length > 0) disableShoppingBtn(true);
        

        ////得到库存值,正式上线才开启
        //$.post("/api/VshopProcess.ashx?action=GetStock", data, function (json) {
        //    $("#spStock").html(json.istock);
        //});

    });

    if ($("#attrtable tr").length <= 0) {
        $("#attrtable").parent().hide();
    }

    //微信分享接口开始
    var Items = $("#ItemParams").text();
    var SetItems = Items.split('$')[0];
    var NoSetItems = Items.split('$')[1];
    var title;
    var link;
    var imgUrl;
    var Dec;
    if ($.trim(SetItems.split('|')[0]) != "") {
        imgUrl = $.trim(SetItems.split('|')[0]);
    }
    else {
        imgUrl = $.trim(NoSetItems.split('|')[0]);
    }
    if ($.trim(SetItems.split('|')[1]) != "") {
        title = SetItems.split('|')[1];
    }
    else {
        title = NoSetItems.split('|')[1];
    }
    if ($.trim(SetItems.split('|')[2]) != "") {
        Dec = SetItems.split('|')[2];
    }
    else {
        Dec = $.trim(NoSetItems.split('|')[2]);
    }
    link = NoSetItems.split('|')[3];
    link = $.trim(link);//修复IOS空格问题
    WinXinShareMessage(title, Dec, link, imgUrl);
    //微信分享接口结束

</script>
<script src="/utility/vproduct.service.helper.js" type="application/javascript"> </script>
<script src="/script/swipe.js"></script>
<!--<hi:common_footer runat="server" />-->
 